# Архитектура игры WitcherRogue

## Разработчики

- Лебедев Егор
- Карнаухов Кирилл
- Худяков Юрий
- Сурков Петр

## Общие сведения о системе

### Назначение

WitcherRogue -- игра с тайтловой графикой в жанре Rogue-like.

### Описание

Есть главный герой, которым управляет игрок. Он попадает на уровень, в котором должен убить босса. Сделать это сразу
он, вероятно, не сможет. Сначала придётся убивать мелких мобов и собирать улучшения для героя:
новое оружие, зелья и броню. В игре также есть таймер, засекающий время одной игры.

### Границы системы

- Игра предназначена для одного человека, для игры на одном компьютере
- В игре есть главный герой, которым управляет игрок
- Управление героем осуществляется с помощью клавиатуры, клавиши для управления можно задавать в настройках
- Игра происходит в реальном времени
- Игру нельзя сохранить или загрузить, весь прогресс после смерти героя сбрасывается
- Уровни в игре генерируются автоматически, но можно загрузить готовый уровень из файла
- Игровой мир состоит из тайтлов, в каждом тайтле может находиться лишь одна сущность: герой, моб, стена, улучшение
  для героя
- Герой может перемещаться в 4 стороны (вверх, вниз, влево, вправо)
- В игре есть только ближний бой. Для атаки героя должны находиться на соседних тайтлах. Бой происходит
  автоматически, результат зависит от параметров оружия (у оружия есть вилка в рамках которой наносится урон) и
  героя.
- Язык английский, но есть возможность добавить перевод на другие языки

### Контекст системы

Игра должна запускаться без необходимости установки сторонних библиотек и на всех основных платформах.

## Architectural drivers

### Технические ограничения

Для выбранного языка должен существовать игровой движок с тайтловой графикой

### Бизнес-ограничения

- Результат через 2 месяца
- Высокая оценка по SD

### Качественные характеристики системы

- Сопровождаемость
- Расширяемость
- Масштабируемость

### Ключевые функциональные требования

- В игре тайтловая графика, вид сверху
- В игре есть герой, способный перемещаться по карте в 4 основных направлениях
- Герой атакует рядом находящихся соперников
- Бой происходит автоматически
- В игре есть враждебные мобы, из убийства которых выпадают предметы
- Зелья могут влиять на характеристики героя и врагов

## Роли и случаи использования

### Роли

### Типичный пользователь

Имя: Тимофей

Возраст: 35 лет

![user](img/user.jpeg)

Пользуется macos, увлекается машинным обучением, весной ездит в "отпуск". В "отпуске" любит отвлечься от работы, играя в
Rogue-like и критикуя студентов за их игры.

## Viewpoint

### Композиция

TODO диаграмма

- Input events handler: детектирует нажатие клавиш с клавиатуры
- Fight handler: детектирует нахождение врагов по близости и атакует их
- Movement handler: отвечает за перемещение героя и мобов
- Stuff handler: управление предметами внутри игры
- Level environment: хранит внутри себя уровень и состояние предметов
- Level generator: создаёт игровой уровень
- Mobs model: отвечает за положение мобов и их состояние
- Player model: положение игрока и его состояние
- GUI inventory view: для отображения инвентаря героя
- GUI level view: отображение уровня
- GUI interface: меню

### Логическая структура

TODO диаграмма

- InputHandler: детектирует клавиши и отправляет их в PlayerController.
- Item.
    - Weapon: определяет диапазон урона и прочность.
        - SwordWeapon: меч.
    - Armor: текущее состояние брони и от чего защищает.
    - Potion: эффект зелья.
- Cell: информация о тайтле (содержимое и местоположение).
- CellContent: что конкретно находится внутри тайтла.
    - CharacterCellContent: герой или моб.
        - PlayerCellContent: герой.
        - MobCellContent: моб.
    - WallCellContent: часть карты, по которой нельзя ходить.
    - SpaceCellContent: часть карты, по которой можно ходить.
- Location: местоположение на уровне.
- LevelState: хранит информацию о всех тайтлах на уровне.
- LevelGenerator: генерирует новый уровень.
- Character: местоположение, контроллер, текущее здоровье, предметы и примененные зелья и броня.
    - Player: информация о игроке
    - Mob: информация о мобе.
        - RegularMob: обычный моб.
            - WitchMob: ведьма.
            - DogMob: сторожевой пес.
            - GuardianMob: сторож.
            - RogueMob: разбойник.
            - BossMob: босс.
- CharacterController: управление героем или мобом (перемещение, использование предметов, принятие эффекта зелья,
  использование инвентаря).
    - PlayerController: управление героем с помощью приходящей ему информации от InputHandler.
    - MobController: управление мобом с помощью AI.
- FightController: управление двух персонажей.
- InventoryManager: хранит информацию о предметах внутри инвентаря у персонажа, умеет добавлять и удалять
  предметы.
- Timer: следит за прошедшим временем.
- GameState: включает таймер, хранит настройки и следит, жив ли герой и босс.
- Settings: хранит настройки игры.
- InterfaceView.
    - ItemView: отображение предмета.
        - WeaponView: отображение оружия.
        - PotionView: отображение зелья.
        - ArmorView: отображение брони.
    - InventoryView: отобразить список предметов в инвентаре.
    - HealthView: отображение здоровья персонажа.
    - TimerView: отображение таймера.
- LevelView: отображение уровня.
- CellView: отображение тайтла.
- MenuView: отображение меню.
- SettingsView: отображение настроек.

### Взаимодействия

TODO диаграмма

- Бой: персонаж и моб атакуют друг друга в зависимости от их брони и оружия, уменьшая их здоровье. Бой заканчивается,
  когда кто-то из них умирает. Происходит, когда два враждебных персонажа стоят на соседних клетках.
- Поднятие предмета: когда персонаж подходить к предмету и решает его взять, то предмет переходит в инвентарь.
- Использование зелья: персонаж может применить зелье на себя или другого персонажа, влияя на его характеристики.
- Использование оружия: если у персонажа есть в инвентаре оружие, он может его взять и использовать в бою.
- Использование брони: если у персонажа есть в инвентаре броня, он может ее надеть на себя.

### Состояния

TODO диаграмма

- Состояние героя:
  - Ведет бой.
  - Не ведет бой.
- Состояние моба:
  - Ведет бой.
  - Собирается начать бой (идет к нему).
  - Игнорирует героя.
- Состояние игры:
  - В процессе.
  - Победа.
  - Проигрыш.
- Состояние предмета:
  - Лежит на земле.
  - Использовано.
  - Лежит в инвентаре у персонажа.
