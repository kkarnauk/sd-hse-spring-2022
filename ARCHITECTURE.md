# Архитектура MyHwProj

## Разработчики

- Карнаухов Кирилл
- Худяков Юрий
- Сурков Петр
- Лебедев Егор

## Общие сведения о системе

### Назначение

MyHwProj -- система для проверки домашних заданий студентов

### Описание

Эта система позволяет "удобно" создавать и сдавать домашки преподавателям и студентам. К тому же система позволяет
добавлять собственные проверялки для задач.


### Границы системы

- Система рассчитана на то, что существует ровно один преподаватель.
- Система рассчитана на то, что существует ровно один студент.
- Система рассчитана на то, что есть ровно один курс (предмет).

### Контекст системы

Система должна запускаться без необходимости установки сторонних библиотек на основных платформах.

## Architectural drivers

### Технические ограничения

Для выбранного языка должен существовать фреймворк для разработки веб сервиса и поддержка RabbitMQ.

### Бизнес-ограничения

- Результат через 2 недели
- Высокая оценка по SD

### Качественные характеристики системы

- Сопровождаемость: с системой удобно работать, есть тесты
- Расширяемость: легко добавить новую проверялку для препода, домашку

### Ключевые функциональные требования

- студент может:
    - просматривать список домашних работ, отсортированный по близости дедлайна, причём должны показываться только
      работы, дата публикации которых уже наступила;
    - сдать решение в виде ссылки на GitHub — для этого ему надо кликнуть на элемент списка домашних работ, в результате
      чего он попадёт на экран с детальной информацией о работе (включая полное условие), полем для ввода ссылки на
      решение и кнопкой «Submit»;
    - просмотреть список результатов, отсортированный по дате сдачи;
    - просмотреть детальную информацию о попытке по клику на элемент списка результатов,
    - включая текстовый вывод программы-проверялки;
- препод может:
    - добавить новую домашнюю работу;
    - просмотреть список результатов, отсортированный по дате сдачи;
    - просмотреть детальную информацию о попытке по клику на элемент списка результатов, включая текстовый вывод
      программы-проверялки;

## Роли и случаи использования

### Роли

- Студент
- Препод

Случаи использования:

- Преподаватель хочет добавить новое задание для студентов, а затем просмотреть список результатов
- Студент хочет выбрать задание из списка, прочитать условие и отправить решение на него.

### Типичный пользователь

Имя: Тимофей

Возраст: 35 лет

![user](img/user.png)

Пользуется macos, увлекается машинным обучением, весной ездит в "отпуск". В "отпуске" любит проверять домашки критикуя
студентов. Любит добавлять извращённые способы тестирования студентов.

----

Имя: Юрий Литвинов

Возраст: ?? лет

![user](img/user2.png)

Любит выполнять домашки исключтельно на C#. Ненавидит Kotlin, Java, Python, C, C++, Haskell и другие второсортные языки.

## Viewpoint

### Композиция

![Components](img/components.svg)

- `Web Server` роутит адреса, валидирует данные, общается с репозиторием
- `Runner` берёт задачу из очереди задач из RabbitMQ, выполняет её, кладёт результат в очередь с результатами
- `ResultProcessor` берёт результаты из очереди с результатами, записывает их через репозиторий в БД
- `Repository` является интерфейсом, через который можно сохранять любые необходимые данные в БД

### Логическая структура

![Classes](img/classes.svg)

- `Homework` -- модель домашнего задания с уникальным идентификатором, хранит `HomeworkContent` 
  - `id` -- идентификатор домашки
- `HomeworkContent` -- модель домашнего задания
  - `id` -- идентификатор домашки
  - `startDate` -- дата сдачи
  - `endDate` -- дедлайн сдачи
  - `statement` -- условие задания
- `Submission` -- модель решения с уникальным идентификатором, хранит `SubmissionContent`
  - `id` -- идентификатор решения
  - `checkerId` -- идентификатор чекера, который должен быть запущен
- `SubmissionContent` -- модель решения
  - `submissionDate` -- дата отправки решения
  - `linkToSolution` -- ссылка на решение на GitHub
- `SubmissionResult`
  - `result` -- верное или нет решение
  - `message` -- комментарий проверялки
  - `checkDate` -- дата проверки
- `Checker` -- модель чекера с уникальным идентификатором, хранит `CheckerContent`
  - `id` -- идентификатор чекера
- `CheckerContent` -- хранит программу, которая будет запущена в качестве проверялки
  - `content` -- байты, определяющие программу

-----

- `Respository` -- интерфейс для хранения данных приложения
    - `getHomework(id)` -- получить `HomeworkContent` по идентификатору домашки
    - `getSubmission(id)` -- получить `SubmissionContent` по идентификатору решения
    - `getSubmissionResult(id)` -- получить `SubmissionResult` по идентификатору решения
    - `getAllHomeworks` -- получить все `Homework`
    - `getAllSubmissions(homeworkId)` -- получить все `Submission` по идентификатору домашки
    - `addHomework(homeworkContent)` -- добавить домашку 
    - `addSubmission(submissionContent)` -- добавить решение
- `RepositoryFacade` -- нужен, чтобы другие сервисы могли общаться с `Repository`, ходит с помощью REST к
  реализации `Repository`
- `RepositoryImpl` -- стандартная реализация `Repository`

-----

- `QueueHandler` -- работает с RabbitMQ
  - `sendTaskForRunner` -- отправить задачу
  - `sendResult` -- отправить результат
  - `addCallbackForTask` -- добавить коллбек на задачу
  - `addCallbackForResult` -- добавить коллбек на результат
- `QueueHandlerFacade` -- нужен, чтобы другие сервисы могли общаться с `QueueHandler`, 
  ходит с помощью REST к реализации `QueueHandler`
- `QueueHandlerImpl` -- стандартная реализация `QueueHandler`
- `QueueHandlerRoutine` -- тот, кто запускает `QueueHandler`

-----

- `Runner` -- тот, кто запускает чекеры
  - `queueHandler` -- ссылка на `QueueHandler`, чтобы отдавать результаты
  - `run` -- запустить чекер
- `RunnerRoutine` -- тот, кто запускает `Runner`
- `RunnerFacade` -- нужен, чтобы другие сервисы могли общаться с `Runner`, ходит с помощью REST к реализации `Runner`
- `RunnerImpl` -- стандартная реализация `Runner`

-----

- `WebServer` -- хранит очередь и репозиторий, обрабатывает REST запросы
- `GetHomework` -- REST запрос, который получает домашку по id
- `GetHomeworks` -- REST запрос, который получает все домашки
- `AddHomework` -- REST запрос, который добавляет домашку с конкретным контентом
- `GetSubmission` -- REST запрос, который получает попытку по id
- `GetSubmissions` -- REST запрос, который получает все попытки
- `AddSubmission` -- REST запрос, который добавляет попытку
- `GetSubmissionResult` -- REST запрос, который по id попытки получает ее результат
- `SendToCheck` -- REST запрос, который отправляет на проверку попытку с конкретным id
- `AddChecker` -- REST запрос, который добавляет новый checker

## Технологии

* Kotlin -- основной язык разработки, имеет все необходимые SDK для проекта.
* Exposed -- ORM-фрейморк для Kotlin.
* RabbitMQ -- брокер сообщений. Считаем, что Kafka -- это переуcложнение для данной задачи.
* Ktor -- создание REST API и генерация HTML. Это самый популярный и очень удобный Kotlin-way фреймворк для данных задач. Вся команда с ним знакома.
